<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MYPD 마이데이터의 첫걸음</title>

    
    <!-- SWIPER -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"/>
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="../stylesheets/swagger_ui.css">
    <link rel="stylesheet" href="../stylesheets/home.css">
    <link rel="stylesheet" href="../stylesheets/default.css">
    <link rel="shortcut icon" type="image/x-icon" href="../images/logo-fabicon.png">


</head>
<body class="body_bg">
    <div class="about_nav">
        <nav class="navigation">
            <%- include ("./header") %>
        </nav>
    </div>

    <div class="header">
        <h1>마이데이터 API 서버 테스트</h1>
        <p>통합테스트 - 인증요청</p>
    </div>

    <main class="main_bg">
        <aside>
        </aside>
        
        <!-- 왼쪽 사이드 바-->
        <section style="position:relative">
            <div class="side_bar2">     

                <div class="dropdown">
                    <button class="dropdown-btn"><i class="fa-solid fa-mobile"></i>&nbsp;&nbsp;&nbsp;마이데이터 서비스 테스트 </button>
                    <div class="dropdown-submenu">
                        <a href="../testbed/unit_svc">ㄴ단위테스트</a>
                        <a href="../testbed/inte_svc">ㄴ통합테스트</a>
                        <a href="../testbed/link_svc">ㄴ연동테스트</a>
                    </div>
                </div>

                <div class="dropdown">
                    <button class="dropdown-btn"><i class="fa-solid fa-server"></i>&nbsp;&nbsp;API 서비스 테스트</button>
                    <div class="dropdown-submenu">
                        <a href="../testbed/unit_api">ㄴ단위테스트</a>
                        <a href="../testbed/inte_api">ㄴ통합테스트</a>
                        <a href="../testbed/link_api">ㄴ연동테스트</a>
                    </div>
                </div>

                <div class="dropdown">
                    <button class="dropdown-btn"><i class="fa-sharp fa-solid fa-gear"></i>&nbsp;&nbsp;테스트 관리</button>
                    <div class="dropdown-submenu">
                        <a href="../mypage/editdata_list#!reg_data">ㄴ테스트 데이터 관리</a>
                        <a href="../mypage/editdata_list#!reg_svc">ㄴ테스트 서비스 관리</a>
                    </div>
                </div>

                <div class="dropdown">
                    <button class="dropdown-btn"><i class="fas fa-list"></i>&nbsp;&nbsp;테스트 내역 조회</button>
                    <div class="dropdown-submenu">
                        <a href="#none">ㄴ마이데이터 서비스 테스트</a>
                        <a href="#none">ㄴAPI 서버 테스트</a>
                    </div>
                </div>
            </div>    


            <!-- 중앙 내용 -->
            <!-- SWAGger UI-->
            <form class="swagger-ui" method="post" action="/testbed/inte_api_access">
                <div class="wrapper">
                    <div class="block col-12 block-desktop col-12-desktop">
                        <div>
                            <span>
                                <div class="opblock-tag-section is-open">
                                    <div class="no-margin">
                                        <div class="operation-tag-content">
                                            <span>
                                                <div
                                                    class="opblock opblock-get is-open"
                                                    id="operations-MydataAuthorization-get_v1_oauth_oauth_api_authorize_api">
                                                    <div class="no-margin">
                                                        <div class="opblock-body">
                                                            <div class="opblock-section">
                                                                <div class="parameters-container">
                                                                    <div class="table-container">
                                                                        <table class="parameters">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th class="col_header parameters-col_name">Name</th>
                                                                                    <th class="col_header parameters-col_description">Description</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                <tr data-param-name="x-user-ci" data-param-in="header">
                                                                                    <td class="parameters-col_name">
                                                                                        <div class="parameter__name required">x-user-ci<span>&nbsp;*</span></div>
                                                                                        <div class="parameter__type"></div>
                                                                                        <div class="parameter__deprecated"></div>
                                                                                        <div class="parameter__in">(header)</div>
                                                                                    </td>
                                                                                    <td class="parameters-col_description">
                                                                                        <div class="renderedMarkdown">
                                                                                            <p>정보주체 CI</p>
                                                                                        </div><input type="text" name="x-user-ci" placeholder="x-user-ci" value=""></td>
                                                                                </tr>
                                                                                <tr data-param-name="x-api-tran-id" data-param-in="header">
                                                                                    <td class="parameters-col_name">
                                                                                        <div class="parameter__name required">x-api-tran-id<span>&nbsp;*</span></div>
                                                                                        <div class="parameter__type"></div>
                                                                                        <div class="parameter__deprecated"></div>
                                                                                        <div class="parameter__in">(header)</div>
                                                                                    </td>
                                                                                    <td class="parameters-col_description">
                                                                                        <div class="renderedMarkdown">
                                                                                            <p>거래고유번호</p>
                                                                                        </div><input type="text" name="x-api-tran-id" placeholder="x-api-tran-id" value=""></td>
                                                                                </tr>
                                                                                <tr data-param-name="org_code" data-param-in="query">
                                                                                    <td class="parameters-col_name">
                                                                                        <div class="parameter__name required">org_code<span>&nbsp;*</span></div>
                                                                                        <div class="parameter__type"></div>
                                                                                        <div class="parameter__deprecated"></div>
                                                                                        <div class="parameter__in">(query)</div>
                                                                                    </td>
                                                                                    <td class="parameters-col_description">
                                                                                        <div class="renderedMarkdown">
                                                                                            <p>기관코드</p>
                                                                                        </div><input type="text" name="org_code" placeholder="org_code" value=""></td>
                                                                                </tr>
                                                                                <tr data-param-name="response_type" data-param-in="query">
                                                                                    <td class="parameters-col_name">
                                                                                        <div class="parameter__name required">response_type<span>&nbsp;*</span></div>
                                                                                        <div class="parameter__type"></div>
                                                                                        <div class="parameter__deprecated"></div>
                                                                                        <div class="parameter__in">(query)</div>
                                                                                    </td>
                                                                                    <td class="parameters-col_description">
                                                                                        <div class="renderedMarkdown">
                                                                                            <p>인가코드 반환</p>
                                                                                        </div><input type="text" name="response_type" placeholder="response_type" value=""></td>
                                                                                </tr>
                                                                                <tr data-param-name="client_id" data-param-in="query">
                                                                                    <td class="parameters-col_name">
                                                                                        <div class="parameter__name required">client_id<span>&nbsp;*</span></div>
                                                                                        <div class="parameter__type"></div>
                                                                                        <div class="parameter__deprecated"></div>
                                                                                        <div class="parameter__in">(query)</div>
                                                                                    </td>
                                                                                    <td class="parameters-col_description">
                                                                                        <div class="renderedMarkdown">
                                                                                            <p>클라이언트 식별값</p>
                                                                                        </div><input type="text" name="client_id" placeholder="client_id" value=""></td>
                                                                                </tr>
                                                                                <tr data-param-name="redirect_uri" data-param-in="query">
                                                                                    <td class="parameters-col_name">
                                                                                        <div class="parameter__name required">redirect_uri<span>&nbsp;*</span></div>
                                                                                        <div class="parameter__type"></div>
                                                                                        <div class="parameter__deprecated"></div>
                                                                                        <div class="parameter__in">(query)</div>
                                                                                    </td>
                                                                                    <td class="parameters-col_description">
                                                                                        <div class="renderedMarkdown">
                                                                                            <p>마이데이터 서비스 URI</p>
                                                                                        </div><input type="text" name="redirect_uri" placeholder="redirect_uri" readonly value="https://localhost:3000/testbed/inte_api_access" ></td>
                                                                                </tr>
                                                                                <tr data-param-name="state" data-param-in="query">
                                                                                    <td class="parameters-col_name">
                                                                                        <div class="parameter__name required">state<span>&nbsp;*</span></div>
                                                                                        <div class="parameter__type"></div>
                                                                                        <div class="parameter__deprecated"></div>
                                                                                        <div class="parameter__in">(query)</div>
                                                                                    </td>
                                                                                    <td class="parameters-col_description">
                                                                                        <div class="renderedMarkdown">
                                                                                            <p>CSRF 방지 목적의 임의설정 값</p>
                                                                                        </div><input type="text" name="state" placeholder="state" value=""></td>
                                                                                </tr>
                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </span>
                        </div>
                    </div>
                    <div class="execute-wrapper">
                        <button type="submit" id="nextclick" style="display: none;"></button>
                        <button onclick="fetchAPI()" type="button" class="btn execute opblock-control__btn" id="popupclick">인증 요청</button>
                    </div>
                </div>
            </form>
        </section>        

        <div id="topButton" style="cursor: pointer"><img src="../images/scrollup.png" id="topButtonImg" width="40%"></div>
        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../javascripts/ClickToMove.js"></script>
        <script src="../javascripts/ScrollUp.js"></script>
        <!-- 오른쪽 사이드바 -->
        <aside></aside>

    </main>
    <script src="//code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="../javascripts/service_test.js"></script>
    <script>
        // document.getElementById("popupclick").onclick = function() {
        //     var myWindow = window.open("/testbed/popup", "인증 팝업", "width = 400, height = 500, top = 100, left = 200, location = no");
        // }
        function fetchAPI () {
            $.ajax({
                url: "/testbed/inte_api_access",
                type: "POST",
                async: false,
                data: {
                    //"x-user-ci" : $('input[name=x-user-ci]').val(),
                    //"x-api-tran-id" : $('input[name=x-api-tran-id]').val(),
                    "org_code" : $('input[name=org_code]').val(),
                    //"response_type" : $('input[name=response_type]').val(),
                    "client_id" : $('input[name=client_id]').val(),
                    "redirect_uri" : $('input[name=redirect_uri]').val()
                    //me=state]').val()
                },
                success : function(data){
                    let params = {
                        "grant_type": "authorization_code",
                        "response_type": "code",
                        "orgCode" : data["org_code"],
                        "client_id": data["client_id"],
                        "redirect_uri": data["redirect_uri"],
                        // "username": "username",
                        // "password": "password"
                    };
                    const query = Object.keys(params)
                                    .map(k => encodeURIComponent(k) + '=' + encodeURIComponent(params[k]))
                                    .join('&');
                    const url = "https://mypd.kr:3030/oauth/?" + query;
                    fetch(url, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',  // This is REALLY important
                            'X-FSI-UTCT-TYPE' : 'TGC00002'
                        },
                    }).then((response) =>{
                            var options = 'top=10, left=10, width=500, height=700, status=no, menubar=no, toolbar=no, resizable=no';
                            var child = window.open(response.url,"엿",options);
                    }) 
                }
            })
        }
    </script>

</body>
</html>