<!DOCTYPE html>
<html lang="kor">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

        <!--CSS -->
        <link rel="stylesheet" href="../stylesheets/style.css">
        <link rel="shortcut icon" type="image/x-icon" href="../images/logo-fabicon.png">
        <title>기업 회원 가입</title>
    </head>

    <body class="huji">
        <div class="logo" style="margin-bottom : 20px;">
            <!-- <a href="index"></a> -->
            <img
                src="../images/logo.png"
                width="280px"
                height="100%"
                alt=""
                id="login_page">
            <p class="page_title" style="margin-bottom : 10px;">기업 회원 가입</p>
            <p style="font-size: 12px;">가입을 통해서 더 다양한 서비스 만나보세요!</p3>
        </div>

<<<<<<< Updated upstream
    <div class="input">
        <form class="joinBox" method="POST" onsubmit="return checkAll()" action="/user/join" >
            <div class="inputJBox">
                <span class="star">*</span>
                <input type="text" id="number" name="number" placeholder="사업자 등록번호" >
                <button class="joinBtn">조회</button>
            </div>
            <div class="inputJBox">
                <span class="star">*</span>
                <input type="text" id="id" name="id" placeholder="아이디 입력 (6 ~ 20자)" required="required" autofocus="autofocus">
                <!--<button class="joinBtn">중복 확인</button>-->
            </div>
            <span class="error_next_box"></span>
            <div class="inputJBox">
                <span class="star">*</span>
                <input type="password" id="pw" name="pw" placeholder="비밀번호 입력 (문자, 숫자, 특수문자 포함 8 ~ 20자)" required="required" autofocus="autofocus">
            </div>
            <span class="error_next_box"></span>
            <div class="inputJBox">
                <span class="star">*</span>
                <input type="password" id="pw_check" name="pw_check" placeholder="비밀번호 재입력" required="required" autofocus="autofocus">
            </div>
            <span class="error_next_box"></span>
            <div class="inputJBox">
                <span class="star">*</span>
                <input type="text" id="email" name="f_email" placeholder="이메일 주소" required="required" autofocus="autofocus">
                <span class="golbang">@</span>
                <input type="text" id="email" name="s_email" placeholder="직접 입력" required="required" autofocus="autofocus">
                <button class="joinBtn">인증코드 발송</button>
            </div>
            <div class="inputJBox">
                <input type="text" id="email" name="email_check" placeholder="인증확인" required="required" autofocus="autofocus">
                <button class="joinBtn" style="width: 70px;">인증확인</button>
            </div>
            <div class="BOX">
                <div class="inputBox" style="width : 320px; padding-bottom: 5px;">
                    <p3 style="font-size: 12px; font-weight: 700;">전체 동의</p3>
                    <label class="checkbox">
                        <span class="p-navbar__menu"></span>
                        <input type="checkbox">
                        <span class="checkbox_icon"></span>
                    </label>
=======
        <div class="input">
            <form
                class="joinBox"
                method="POST"
                onsubmit="return checkAll()"
                action="/user/join">
                <div class="inputJBox">
                    <span class="star">*</span>
                    <input type="text" id="number" name="number" placeholder="사업자 등록번호">
                    <button class="joinBtn">조회</button>
>>>>>>> Stashed changes
                </div>
                <div class="inputJBox">
                    <span class="star">*</span>
                    <input
                        type="text"
                        id="id"
                        name="id"
                        placeholder="아이디 입력 (6 ~ 20자)"
                        required="required"
                        autofocus="autofocus">
                    <!--<button class="joinBtn">중복 확인</button>-->
                </div>
                <span class="error_next_box"></span>
                <div class="inputJBox">
                    <span class="star">*</span>
                    <input
                        type="password"
                        id="pw"
                        name="pw"
                        placeholder="비밀번호 입력 (문자, 숫자, 특수문자 포함 8 ~ 20자)"
                        required="required"
                        autofocus="autofocus">
                </div>
                <span class="error_next_box"></span>
                <div class="inputJBox">
                    <span class="star">*</span>
                    <input
                        type="password"
                        id="pw_check"
                        name="pw_check"
                        placeholder="비밀번호 재입력"
                        required="required"
                        autofocus="autofocus">
                </div>
                <span class="error_next_box"></span>
                <div class="inputJBox">
                    <span class="star">*</span>
                    <input
                        type="text"
                        id="femail"
                        name="f_email"
                        placeholder="이메일 주소"
                        required="required"
                        autofocus="autofocus">
                    <span class="golbang">@</span>
                    <input
                        type="text"
                        id="semail"
                        name="s_email"
                        placeholder="직접 입력"
                        required="required"
                        autofocus="autofocus">
                    <button class="joinBtn" type="button" onclick="sendMail()">인증코드 발송</button>
                </div>
                <div class="inputJBox">
                    <input
                        type="text"
                        id="cmail"
                        name="email_check"
                        placeholder="인증확인"
                        required="required"
                        autofocus="autofocus">
                    <button
                        class="joinBtn"
                        style="width: 70px;"
                        type="button"
                        onclick="checkMail()">인증확인</button>
                </div>
                <div class="BOX">
                    <div class="inputBox" style="width : 320px; padding-bottom: 5px;">
                        <p3 style="font-size: 12px; font-weight: 700;">전체 동의</p3>
                        <label class="checkbox">
                            <span class="p-navbar__menu"></span>
                            <input type="checkbox" id="checkAll">
                            <span class="checkbox_icon"></span>
                        </label>
                    </div>
                    <div style="width : 320px; display: flex; margin: 0 auto; padding-top: 9px;">
                        <p3 style="color: red;">*</p3>
                        <p3 style="font-size: 12px; font-weight: 700;">기업 회원 약관에 동의</p3>
                        <label class="checkbox">
                            <span class="p-navbar__menu"></span>
                            <input type="checkbox" id="check1" name="chk">
                            <span class="checkbox_icon"></span>
                        </label>
                    </div>
                    <div style="width : 320px; display: flex; margin: 0 auto; padding-top: 5px;">
                        <p3 style="color: red;">*</p3>
                        <p3 style="font-size: 12px; font-weight: 700;">개인정보 수집 및 이용에 동의</p3>
                        <label class="checkbox">
                            <span class="p-navbar__menu"></span>
                            <input type="checkbox" id="check2" name="chk">
                            <span class="checkbox_icon"></span>
                        </label>
                    </div>
                </div>
                <div class="btn" style="padding-top: 0;">
                    <button
                        type="submit"
                        class="loginBtn"
                        style="padding: 10px 35px; border-radius:5px !important; font-size: 13px;">
                        <strong>회원가입 완료</strong>
                    </button><br>
                </div>
            </form>
        </div>

        <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
        <script src="../javascripts/joinscr.js"></script>
        <script>
            var ID = document.querySelector('#id');
            var PW = document.querySelector('#pw');
            var PWCheck = document.querySelector('#pw_check');
            var emailF = document.querySelector('#femail');
            var emailS = document.querySelector('#semail');
            var emailCheck = document.querySelector('#cmail');
            var input = document.querySelector('.huji .input');
            var error = document.querySelectorAll('.error_next_box');
            var test = true;

            /*이벤트 핸들러 연결*/

            ID.addEventListener("focusout", checkId);
            PW.addEventListener("focusout", checkPw);
            PWCheck.addEventListener("focusout", comparePw);

            /*콜백 함수*/

            function checkId() {
                var idPattern = /^[a-z0-9][a-z0-9_\-].{4,19}$/;
                var result;
                if (ID.value == "") {
                    error[0].innerHTML = "필수 정보입니다.";
                    error[0].style.color = "red";
                    error[0].style.display = "flex";
                    return false;
                } else if (!idPattern.test(ID.value)) {
                    error[0].innerHTML = "5~20자의 영문 소문자, 숫자와 특수기호(_),(-)만 사용 가능합니다.";
                    error[0].style.color = "red";
                    error[0].style.display = "flex";
                    return false;
                } else {
                    $.ajax({
                        url: "/user/check_overlap",
                        type: "POST",
                        async: false,
                        data: {
                            "ID": ID.value
                        },
                        success: function (data) {
                            if (!data) {
                                error[0].innerHTML = "사용 가능합니다!";
                                error[0].style.color = "#08A600";
                                error[0].style.display = "flex";
                                result = true;
                            } else {
                                error[0].innerHTML = "이미 존재하는 ID입니다.";
                                error[0].style.color = "red";
                                error[0].style.display = "flex";
                                result = false;
                            }
                        }
                    })
                    return result;
                }
            }

            function checkPw() {
                var pwPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[$@$!%*?&])[A-Za-z\d$@$!%*?&].{8,16}$/;
                if (PW.value == "") {
                    error[1].innerHTML = "필수 정보입니다.";
                    error[1].style.color = "red";
                    error[1].style.display = "flex";
                    return false;
                } else if (!pwPattern.test(PW.value)) {
                    error[1].innerHTML = "8~16자 영문 대 소문자, 숫자, 특수문자를 사용하세요.";
                    error[1].style.color = "red";
                    error[1].style.display = "flex";
                    return false;
                } else {
                    error[1].innerHTML = "사용 가능합니다!";
                    error[1].style.color = "#08A600";
                    error[1].style.display = "flex";
                    return true;
                }
            }

            function comparePw() {
                if (PWCheck.value == "") {
                    error[2].innerHTML = "필수 정보입니다.";
                    error[2].style.color = "red";
                    error[2].style.display = "flex";
                    return false;
                } else if (PW.value != PWCheck.value) {
                    error[2].innerHTML = "비밀번호가 일치하지 않습니다.";
                    error[2].style.color = "red";
                    error[2].style.display = "flex"
                    return false;
                } else {
                    error[2].innerHTML = "비밀번호가 일치합니다!";
                    error[2].style.color = "#08A600";
                    error[2].style.display = "flex";
                    return true;
                }
            }

            function checkAll() {
                var result;
                $.ajax({
                    url: "/user/check_all",
                    type: "POST",
                    async: false,
                    data: {
                        "checkID": checkId(),
                        "checkPW": checkPw(),
                        "comparePW": comparePw(),
                        "checkMAIL": checkMail()
                    },

                    success: function (data) {
                        if (data == "true") {
                            console.log("성공" + data);
                            result = true;
                        } else {
                            alert(data);
                            result = false;
                        }
                    }
                })
                console.log("adsfasdfawefㅁㄴㅇㄹ" + $("#check1").is(":checked") == true);
                if ($("#check1").is(":checked") == true && $("#check2").is(":checked") == true) {
                    result = true;
                } else if ($("#check1").is(":checked") == false && $("#check2").is(":checked") == true) {
                    alert("기업 회원 약관에 동의란을 확인해주세요!");
                    result = false;
                } else if ($("#check1").is(":checked") == true && $("#check2").is(":checked") == false) {
                    alert("개인정보 수집 및 이용에 동의란을 확인해주세요!");
                    result = false;
                } else {
                    alert("기업 회원 약관 및 개인정보 수집 및 이용에 동의를 해주세요!");
                    result = false;
                }

                return result;
            }

            function sendMail() {
                if (emailF.value == "" || emailS.value == "") {
                    alert('이메일을 입력하여 주세요!');
                    return false;
                }
                $.ajax({
                    url: "/user/mail_send",
                    type: "POST",
                    async: false,
                    data: {
                        "mail": emailF.value + "@" + emailS.value
                    },
                    success: function (data) {
                        if (data) {
                            alert('인증번호가 발송되었습니다!');
                            auth = data;
                            test = false;
                        } else {
                            auth = false;
                        }
                    }
                })
                return auth;
            }

            function checkMail() {
                var result;
                if (emailF.value == "" || emailS.value == "") {
                    alert('이메일을 입력하여 주세요!');
                    return false;
                } else if (emailCheck.value == "") {
                    alert('인증번호를 입력하여 주세요!');
                    return false;
                } else if (test) {
                    alert('인증코드 발송을 진행하여 주세요!');
                    return false;
                } else {
                    $.ajax({
                        url: "/user/mail_check",
                        type: "POST",
                        async: false,
                        data: {
                            "mail_check": emailCheck.value
                        },
                        success: function (data) {
                            if (data) {
                                result = true;
                                alert('인증이 완료되었습니다.');
                                emailCheck.style.background = "#c7c7c7";
                                emailCheck.readOnly = true;
                            } else {
                                result = false;
                                alert('인증이 실패하였습니다. 메일을 다시 확인해주기 바랍니다!');
                            }
                        }
                    })
                }
                return result;
            }

            $(document).ready(function () {
                $("#checkAll").click(function () {
                    if ($("#checkAll").is(":checked")) 
                        $("input[name=chk]").prop("checked", true);
                    else 
                        $("input[name=chk]").prop("checked", false);
                    }
                );

                $("input[name=chk]").click(function () {
                    var total = $("input[name=chk]").length;
                    var checked = $("input[name=chk]:checked").length;

                    if (total != checked) 
                        $("#checkAll").prop("checked", false);
                    else 
                        $("#checkAll").prop("checked", true);
                    }
                );
            });
        </script>
    </body>
</html>